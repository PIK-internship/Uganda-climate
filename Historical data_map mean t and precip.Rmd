---
title: "R Notebook"
output: html_notebook
---

```{r}
library(ggplot2) #for mapping with ggplot
library(scales)  #for colour scales
library(RColorBrewer) #for colour scales
library(rgdal) #reading shape files
library(tidyr)
library(dplyr)
```

# Import data

The file below contains monthly data for Uganda between 1979-2014. 

```{r}
data <- read.csv("1979-2019_monthly_Uganda.csv", header = TRUE)
```

# Prepare data

Aim: get monthly mean t and rainfall across all years. 

```{r}
# Precipitation
annual_pr<-aggregate(pr ~ lat+lon, data=data, mean, na.rm=TRUE) # precip mean over all years per lat & lon

# Temperature
annual_tas<-aggregate(cbind(tasmax,tasmin) ~ lat+lon, data=data, mean, na.rm=TRUE)
annual_tas$tas<-rowMeans(annual_tas[,c('tasmin','tasmax')], na.rm=TRUE)

# Combine
annual_hist_means<-annual_pr
annual_hist_means$tas<-annual_tas$tas

Uganda<-readOGR('./shp/UGA_adm1.shp', stringsAsFactors = FALSE) # preferred as it is being processed better by ggplot
```

# Map data
## Facet temp and precipitation

```{r}
map_pr_hist <- ggplot() +
  geom_tile(data = annual_hist_means, aes(x = lon, y = lat, fill = pr)) +
  scale_fill_gradientn("%",limits=c(0,170), values = c(0, 0.4,0.6, 1),  # values can twist the legend
                       colours=c(brewer.pal(9,'BuGn')),
                       na.value = 'grey')+
  geom_polygon(data=Uganda, aes(x = long, y=lat, group=group), fill = NA, col="black", size = 0.9) + # for the country map
  geom_hline(yintercept=seq(-2,5,by=2), linetype="dashed", color = "black") + # for y-axis
  geom_vline(xintercept=seq(28,35,by=2), linetype="dashed", color = "black") + # for x-axis
  theme_bw()+
  guides(fill = guide_legend(title="Rainfall, mm")) +
  theme(axis.title.x=element_blank(),
        axis.title.y=element_blank(),
        axis.text=element_text(size=10),
        axis.ticks.length = unit(0.2, "cm"),
        legend.title =element_text(size = 13, face = 'bold', family="DejaVu Sans"),
        legend.text=element_text(size=13), 
        legend.key.width = unit(0.35, "cm"), 
        legend.key.height = unit(0.7, "cm"),
        legend.margin = margin(1, 1, 1, 0),
        legend.position = "right")  +
  scale_x_continuous(breaks= seq(28,35,by=2) ) +
  scale_y_continuous(breaks= seq(-2,5,by=2) ) +
  coord_map(xlim = c(29.5,35), ylim = c(-1.5,4.5)) 

plot(map_pr_hist)
```




```{r}
map_t_hist <- ggplot() +
  geom_tile(data = annual_hist_means, aes(x = lon, y = lat, fill = tas)) +
  scale_fill_gradientn("%",limits=c(15,30), values = c(0, 0.4,0.6, 1),  # values can twist the legend
                       colours=c(brewer.pal(9,'YlOrBr')),
                       na.value = 'grey')+
  geom_polygon(data=Uganda, aes(x = long, y=lat, group=group), fill = NA, col="black", size = 0.9) + # for the country map
  geom_hline(yintercept=seq(-2,5,by=2), linetype="dashed", color = "black") + # for y-axis
  geom_vline(xintercept=seq(28,35,by=2), linetype="dashed", color = "black") + # for x-axis
  theme_bw()+ # for canvas
  guides(fill = guide_legend(title="Temperature, C")) +
  theme(axis.title.x=element_blank(),
        axis.title.y=element_blank(),
        axis.text=element_text(size=10),
        axis.ticks.length = unit(0.2, "cm"),
        legend.title =element_text(size = 13, face = 'bold', family="DejaVu Sans"),
        legend.text=element_text(size=13), 
        legend.key.width = unit(0.35, "cm"), 
        legend.key.height = unit(0.7, "cm"),
        legend.margin = margin(1, 1, 1, 0),
        legend.position = "right")  +
  scale_x_continuous(breaks= seq(28,35,by=2) ) +
  scale_y_continuous(breaks= seq(-2,5,by=2) ) +
  coord_map(xlim = c(29.5,35), ylim = c(-1.5,4.5)) 

plot(map_t_hist)
```


